import org.apache.tools.ant.filters.ReplaceTokens

ospackage {
    requires('default-jdk')
    requires('tomcat7')
    //requires('libtcnative-1')

    from(file('root')) {
        into('/')
        user = 'tomcat7' // A little
        permissionGroup = 'tomcat7'
    }
	link("/usr/local/bin/userdata", "metadatavars")
	link("/usr/local/bin/fetchsshkey", "metadatavars")

    postInstall('rm -fr /var/lib/tomcat7/webapps/ROOT')

    postInstall('cp /usr/share/tomcat7/logrotate.template /etc/logrotate.d/tomcat7')

    // Defaults used by Asgard
    postInstall("perl -p -i -e 's/port=\"8080\"/port=\"7001\"/gi' /var/lib/tomcat7/conf/server.xml")

    // Make sure you actually accept the Oracle license before choosing to use this option
    if (System.getProperty('baseami.includeOracleJdk8', 'false') == 'true') {
        postInstall("add-apt-repository -y ppa:webupd8team/java")
        postInstall("apt-get -y update")
        postInstall("echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections")
        postInstall("apt-get -y install oracle-java8-installer")
    }

    if (System.getProperty('baseami.includeOpenJdk8', 'false') == 'true') {
        postInstall("add-apt-repository -y ppa:openjdk-r/ppa")
        postInstall("apt-get -y update")
        postInstall("apt-get -y install openjdk-8-jdk")
    }
}

